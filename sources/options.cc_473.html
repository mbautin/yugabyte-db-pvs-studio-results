
<html>
<head>

  <meta http-equiv="Content-Type" content="text/html; charset=US-ASCII" />
  <title>options.cc</title>

  <link rel="stylesheet" href="../style.css"/>
  <script src="../jquery-3.2.1.min.js"></script>
</head>
<body>

<pre><code class = "cpp">
<a name="ln1">//  Copyright (c) 2011-present, Facebook, Inc.  All rights reserved.</a>
<a name="ln2">//  This source code is licensed under the BSD-style license found in the</a>
<a name="ln3">//  LICENSE file in the root directory of this source tree. An additional grant</a>
<a name="ln4">//  of patent rights can be found in the PATENTS file in the same directory.</a>
<a name="ln5">//</a>
<a name="ln6">// The following only applies to changes made to this file as part of YugaByte development.</a>
<a name="ln7">//</a>
<a name="ln8">// Portions Copyright (c) YugaByte, Inc.</a>
<a name="ln9">//</a>
<a name="ln10">// Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); you may not use this file except</a>
<a name="ln11">// in compliance with the License.  You may obtain a copy of the License at</a>
<a name="ln12">//</a>
<a name="ln13">// http://www.apache.org/licenses/LICENSE-2.0</a>
<a name="ln14">//</a>
<a name="ln15">// Unless required by applicable law or agreed to in writing, software distributed under the License</a>
<a name="ln16">// is distributed on an &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express</a>
<a name="ln17">// or implied.  See the License for the specific language governing permissions and limitations</a>
<a name="ln18">// under the License.</a>
<a name="ln19">//</a>
<a name="ln20">// Copyright (c) 2011 The LevelDB Authors. All rights reserved.</a>
<a name="ln21">// Use of this source code is governed by a BSD-style license that can be</a>
<a name="ln22">// found in the LICENSE file. See the AUTHORS file for names of contributors.</a>
<a name="ln23"> </a>
<a name="ln24">#include &quot;yb/rocksdb/options.h&quot;</a>
<a name="ln25">#include &quot;yb/rocksdb/immutable_options.h&quot;</a>
<a name="ln26"> </a>
<a name="ln27">#ifndef __STDC_FORMAT_MACROS</a>
<a name="ln28">#define __STDC_FORMAT_MACROS</a>
<a name="ln29">#endif</a>
<a name="ln30"> </a>
<a name="ln31">#include &lt;inttypes.h&gt;</a>
<a name="ln32">#include &lt;limits&gt;</a>
<a name="ln33"> </a>
<a name="ln34">#include &quot;yb/rocksdb/cache.h&quot;</a>
<a name="ln35">#include &quot;yb/rocksdb/compaction_filter.h&quot;</a>
<a name="ln36">#include &quot;yb/rocksdb/comparator.h&quot;</a>
<a name="ln37">#include &quot;yb/rocksdb/env.h&quot;</a>
<a name="ln38">#include &quot;yb/rocksdb/sst_file_manager.h&quot;</a>
<a name="ln39">#include &quot;yb/rocksdb/memtablerep.h&quot;</a>
<a name="ln40">#include &quot;yb/rocksdb/merge_operator.h&quot;</a>
<a name="ln41">#include &quot;yb/util/slice.h&quot;</a>
<a name="ln42">#include &quot;yb/rocksdb/slice_transform.h&quot;</a>
<a name="ln43">#include &quot;yb/rocksdb/table.h&quot;</a>
<a name="ln44">#include &quot;yb/rocksdb/table_properties.h&quot;</a>
<a name="ln45">#include &quot;yb/rocksdb/wal_filter.h&quot;</a>
<a name="ln46">#include &quot;yb/rocksdb/table/block_based_table_factory.h&quot;</a>
<a name="ln47">#include &quot;yb/rocksdb/util/compression.h&quot;</a>
<a name="ln48">#include &quot;yb/rocksdb/util/statistics.h&quot;</a>
<a name="ln49">#include &quot;yb/rocksdb/util/xfunc.h&quot;</a>
<a name="ln50"> </a>
<a name="ln51">namespace rocksdb {</a>
<a name="ln52"> </a>
<a name="ln53">ImmutableCFOptions::ImmutableCFOptions(const Options&amp; options)</a>
<a name="ln54">    : compaction_style(options.compaction_style),</a>
<a name="ln55">      compaction_options_universal(options.compaction_options_universal),</a>
<a name="ln56">      compaction_options_fifo(options.compaction_options_fifo),</a>
<a name="ln57">      prefix_extractor(options.prefix_extractor.get()),</a>
<a name="ln58">      comparator(options.comparator),</a>
<a name="ln59">      merge_operator(options.merge_operator.get()),</a>
<a name="ln60">      compaction_filter(options.compaction_filter),</a>
<a name="ln61">      compaction_filter_factory(options.compaction_filter_factory.get()),</a>
<a name="ln62">      inplace_update_support(options.inplace_update_support),</a>
<a name="ln63">      inplace_callback(options.inplace_callback),</a>
<a name="ln64">      info_log(options.info_log.get()),</a>
<a name="ln65">      statistics(options.statistics.get()),</a>
<a name="ln66">      env(options.env),</a>
<a name="ln67">      delayed_write_rate(options.delayed_write_rate),</a>
<a name="ln68">      allow_mmap_reads(options.allow_mmap_reads),</a>
<a name="ln69">      allow_mmap_writes(options.allow_mmap_writes),</a>
<a name="ln70">      db_paths(options.db_paths),</a>
<a name="ln71">      memtable_factory(options.memtable_factory.get()),</a>
<a name="ln72">      table_factory(options.table_factory.get()),</a>
<a name="ln73">      table_properties_collector_factories(</a>
<a name="ln74">          options.table_properties_collector_factories),</a>
<a name="ln75">      advise_random_on_open(options.advise_random_on_open),</a>
<a name="ln76">      bloom_locality(options.bloom_locality),</a>
<a name="ln77">      purge_redundant_kvs_while_flush(options.purge_redundant_kvs_while_flush),</a>
<a name="ln78">      min_partial_merge_operands(options.min_partial_merge_operands),</a>
<a name="ln79">      disable_data_sync(options.disableDataSync),</a>
<a name="ln80">      use_fsync(options.use_fsync),</a>
<a name="ln81">      compression(options.compression),</a>
<a name="ln82">      compression_per_level(options.compression_per_level),</a>
<a name="ln83">      compression_opts(options.compression_opts),</a>
<a name="ln84">      level_compaction_dynamic_level_bytes(</a>
<a name="ln85">          options.level_compaction_dynamic_level_bytes),</a>
<a name="ln86">      access_hint_on_compaction_start(options.access_hint_on_compaction_start),</a>
<a name="ln87">      new_table_reader_for_compaction_inputs(</a>
<a name="ln88">          options.new_table_reader_for_compaction_inputs),</a>
<a name="ln89">      compaction_readahead_size(options.compaction_readahead_size),</a>
<a name="ln90">      num_levels(options.num_levels),</a>
<a name="ln91">      optimize_filters_for_hits(options.optimize_filters_for_hits),</a>
<a name="ln92">      listeners(options.listeners),</a>
<a name="ln93">      row_cache(options.row_cache),</a>
<a name="ln94">      mem_tracker(options.mem_tracker),</a>
<a name="ln95">      block_based_table_mem_tracker(options.block_based_table_mem_tracker),</a>
<a name="ln96">      iterator_replacer(options.iterator_replacer) {}</a>
<a name="ln97"> </a>
<a name="ln98">ColumnFamilyOptions::ColumnFamilyOptions()</a>
<a name="ln99">    : comparator(BytewiseComparator()),</a>
<a name="ln100">      merge_operator(nullptr),</a>
<a name="ln101">      compaction_filter(nullptr),</a>
<a name="ln102">      compaction_filter_factory(nullptr),</a>
<a name="ln103">      write_buffer_size(4_MB), // Option expects bytes.</a>
<a name="ln104">      max_write_buffer_number(2),</a>
<a name="ln105">      min_write_buffer_number_to_merge(1),</a>
<a name="ln106">      max_write_buffer_number_to_maintain(0),</a>
<a name="ln107">      compression(Snappy_Supported() ? kSnappyCompression : kNoCompression),</a>
<a name="ln108">      prefix_extractor(nullptr),</a>
<a name="ln109">      num_levels(7),</a>
<a name="ln110">      level0_file_num_compaction_trigger(4),</a>
<a name="ln111">      level0_slowdown_writes_trigger(20),</a>
<a name="ln112">      level0_stop_writes_trigger(24),</a>
<a name="ln113">      target_file_size_base(2 * 1048576),</a>
<a name="ln114">      target_file_size_multiplier(1),</a>
<a name="ln115">      max_bytes_for_level_base(10 * 1048576),</a>
<a name="ln116">      level_compaction_dynamic_level_bytes(false),</a>
<a name="ln117">      max_bytes_for_level_multiplier(10),</a>
<a name="ln118">      max_bytes_for_level_multiplier_additional(num_levels, 1),</a>
<a name="ln119">      expanded_compaction_factor(25),</a>
<a name="ln120">      source_compaction_factor(1),</a>
<a name="ln121">      max_grandparent_overlap_factor(10),</a>
<a name="ln122">      soft_rate_limit(0.0),</a>
<a name="ln123">      hard_rate_limit(0.0),</a>
<a name="ln124">      soft_pending_compaction_bytes_limit(0),</a>
<a name="ln125">      hard_pending_compaction_bytes_limit(0),</a>
<a name="ln126">      rate_limit_delay_max_milliseconds(1000),</a>
<a name="ln127">      arena_block_size(0),</a>
<a name="ln128">      disable_auto_compactions(false),</a>
<a name="ln129">      purge_redundant_kvs_while_flush(true),</a>
<a name="ln130">      compaction_style(kCompactionStyleLevel),</a>
<a name="ln131">      compaction_pri(kByCompensatedSize),</a>
<a name="ln132">      verify_checksums_in_compaction(true),</a>
<a name="ln133">      filter_deletes(false),</a>
<a name="ln134">      max_sequential_skip_in_iterations(8),</a>
<a name="ln135">      memtable_factory(std::shared_ptr&lt;SkipListFactory&gt;(new SkipListFactory)),</a>
<a name="ln136">      table_factory(</a>
<a name="ln137">          std::shared_ptr&lt;TableFactory&gt;(new BlockBasedTableFactory())),</a>
<a name="ln138">      inplace_update_support(false),</a>
<a name="ln139">      inplace_update_num_locks(10000),</a>
<a name="ln140">      inplace_callback(nullptr),</a>
<a name="ln141">      memtable_prefix_bloom_bits(0),</a>
<a name="ln142">      memtable_prefix_bloom_probes(6),</a>
<a name="ln143">      memtable_prefix_bloom_huge_page_tlb_size(0),</a>
<a name="ln144">      bloom_locality(0),</a>
<a name="ln145">      max_successive_merges(0),</a>
<a name="ln146">      min_partial_merge_operands(2),</a>
<a name="ln147">      optimize_filters_for_hits(false),</a>
<a name="ln148">      paranoid_file_checks(false),</a>
<a name="ln149">      compaction_measure_io_stats(false) {</a>
<a name="ln150">  assert(memtable_factory.get() != nullptr);</a>
<a name="ln151">}</a>
<a name="ln152"> </a>
<a name="ln153">ColumnFamilyOptions::ColumnFamilyOptions(const Options&amp; options)</a>
<a name="ln154">    : comparator(options.comparator),</a>
<a name="ln155">      merge_operator(options.merge_operator),</a>
<a name="ln156">      compaction_filter(options.compaction_filter),</a>
<a name="ln157">      compaction_filter_factory(options.compaction_filter_factory),</a>
<a name="ln158">      write_buffer_size(options.write_buffer_size),</a>
<a name="ln159">      max_write_buffer_number(options.max_write_buffer_number),</a>
<a name="ln160">      min_write_buffer_number_to_merge(</a>
<a name="ln161">          options.min_write_buffer_number_to_merge),</a>
<a name="ln162">      max_write_buffer_number_to_maintain(</a>
<a name="ln163">          options.max_write_buffer_number_to_maintain),</a>
<a name="ln164">      compression(options.compression),</a>
<a name="ln165">      compression_per_level(options.compression_per_level),</a>
<a name="ln166">      compression_opts(options.compression_opts),</a>
<a name="ln167">      prefix_extractor(options.prefix_extractor),</a>
<a name="ln168">      num_levels(options.num_levels),</a>
<a name="ln169">      level0_file_num_compaction_trigger(</a>
<a name="ln170">          options.level0_file_num_compaction_trigger),</a>
<a name="ln171">      level0_slowdown_writes_trigger(options.level0_slowdown_writes_trigger),</a>
<a name="ln172">      level0_stop_writes_trigger(options.level0_stop_writes_trigger),</a>
<a name="ln173">      target_file_size_base(options.target_file_size_base),</a>
<a name="ln174">      target_file_size_multiplier(options.target_file_size_multiplier),</a>
<a name="ln175">      max_bytes_for_level_base(options.max_bytes_for_level_base),</a>
<a name="ln176">      level_compaction_dynamic_level_bytes(</a>
<a name="ln177">          options.level_compaction_dynamic_level_bytes),</a>
<a name="ln178">      max_bytes_for_level_multiplier(options.max_bytes_for_level_multiplier),</a>
<a name="ln179">      max_bytes_for_level_multiplier_additional(</a>
<a name="ln180">          options.max_bytes_for_level_multiplier_additional),</a>
<a name="ln181">      expanded_compaction_factor(options.expanded_compaction_factor),</a>
<a name="ln182">      source_compaction_factor(options.source_compaction_factor),</a>
<a name="ln183">      max_grandparent_overlap_factor(options.max_grandparent_overlap_factor),</a>
<a name="ln184">      soft_rate_limit(options.soft_rate_limit),</a>
<a name="ln185">      soft_pending_compaction_bytes_limit(</a>
<a name="ln186">          options.soft_pending_compaction_bytes_limit),</a>
<a name="ln187">      hard_pending_compaction_bytes_limit(</a>
<a name="ln188">          options.hard_pending_compaction_bytes_limit),</a>
<a name="ln189">      rate_limit_delay_max_milliseconds(</a>
<a name="ln190">          options.rate_limit_delay_max_milliseconds),</a>
<a name="ln191">      arena_block_size(options.arena_block_size),</a>
<a name="ln192">      disable_auto_compactions(options.disable_auto_compactions),</a>
<a name="ln193">      purge_redundant_kvs_while_flush(options.purge_redundant_kvs_while_flush),</a>
<a name="ln194">      compaction_style(options.compaction_style),</a>
<a name="ln195">      compaction_pri(options.compaction_pri),</a>
<a name="ln196">      verify_checksums_in_compaction(options.verify_checksums_in_compaction),</a>
<a name="ln197">      compaction_options_universal(options.compaction_options_universal),</a>
<a name="ln198">      compaction_options_fifo(options.compaction_options_fifo),</a>
<a name="ln199">      filter_deletes(options.filter_deletes),</a>
<a name="ln200">      max_sequential_skip_in_iterations(</a>
<a name="ln201">          options.max_sequential_skip_in_iterations),</a>
<a name="ln202">      memtable_factory(options.memtable_factory),</a>
<a name="ln203">      table_factory(options.table_factory),</a>
<a name="ln204">      table_properties_collector_factories(</a>
<a name="ln205">          options.table_properties_collector_factories),</a>
<a name="ln206">      inplace_update_support(options.inplace_update_support),</a>
<a name="ln207">      inplace_update_num_locks(options.inplace_update_num_locks),</a>
<a name="ln208">      inplace_callback(options.inplace_callback),</a>
<a name="ln209">      memtable_prefix_bloom_bits(options.memtable_prefix_bloom_bits),</a>
<a name="ln210">      memtable_prefix_bloom_probes(options.memtable_prefix_bloom_probes),</a>
<a name="ln211">      memtable_prefix_bloom_huge_page_tlb_size(</a>
<a name="ln212">          options.memtable_prefix_bloom_huge_page_tlb_size),</a>
<a name="ln213">      bloom_locality(options.bloom_locality),</a>
<a name="ln214">      max_successive_merges(options.max_successive_merges),</a>
<a name="ln215">      min_partial_merge_operands(options.min_partial_merge_operands),</a>
<a name="ln216">      optimize_filters_for_hits(options.optimize_filters_for_hits),</a>
<a name="ln217">      paranoid_file_checks(options.paranoid_file_checks),</a>
<a name="ln218">      compaction_measure_io_stats(options.compaction_measure_io_stats) {</a>
<a name="ln219">  assert(memtable_factory.get() != nullptr);</a>
<a name="ln220">  if (max_bytes_for_level_multiplier_additional.size() &lt;</a>
<a name="ln221">      static_cast&lt;unsigned int&gt;(num_levels)) {</a>
<a name="ln222">    max_bytes_for_level_multiplier_additional.resize(num_levels, 1);</a>
<a name="ln223">  }</a>
<a name="ln224">}</a>
<a name="ln225"> </a>
<a name="ln226">DBOptions::DBOptions()</a>
<a name="ln227">    : create_if_missing(false),</a>
<a name="ln228">      create_missing_column_families(false),</a>
<a name="ln229">      error_if_exists(false),</a>
<a name="ln230">      paranoid_checks(true),</a>
<a name="ln231">      env(Env::Default()),</a>
<a name="ln232">      checkpoint_env(nullptr),</a>
<a name="ln233">      rate_limiter(nullptr),</a>
<a name="ln234">      sst_file_manager(nullptr),</a>
<a name="ln235">      info_log(nullptr),</a>
<a name="ln236">#ifdef NDEBUG</a>
<a name="ln237">      info_log_level(INFO_LEVEL),</a>
<a name="ln238">#else</a>
<a name="ln239">      info_log_level(DEBUG_LEVEL),</a>
<a name="ln240">#endif  // NDEBUG</a>
<a name="ln241">      max_open_files(5000),</a>
<a name="ln242">      max_file_opening_threads(1),</a>
<a name="ln243">      max_total_wal_size(0),</a>
<a name="ln244">      statistics(nullptr),</a>
<a name="ln245">      disableDataSync(false),</a>
<a name="ln246">      use_fsync(false),</a>
<a name="ln247">      db_log_dir(&quot;&quot;),</a>
<a name="ln248">      wal_dir(&quot;&quot;),</a>
<a name="ln249">      delete_obsolete_files_period_micros(6ULL * 60 * 60 * 1000000),</a>
<a name="ln250">      base_background_compactions(-1),</a>
<a name="ln251">      max_background_compactions(1),</a>
<a name="ln252">      num_reserved_small_compaction_threads(-1),</a>
<a name="ln253">      compaction_size_threshold_bytes(std::numeric_limits&lt;uint64_t&gt;::max()),</a>
<a name="ln254">      max_subcompactions(1),</a>
<a name="ln255">      max_background_flushes(1),</a>
<a name="ln256">      max_log_file_size(0),</a>
<a name="ln257">      log_file_time_to_roll(0),</a>
<a name="ln258">      keep_log_file_num(1000),</a>
<a name="ln259">      recycle_log_file_num(0),</a>
<a name="ln260">      max_manifest_file_size(std::numeric_limits&lt;uint64_t&gt;::max()),</a>
<a name="ln261">      table_cache_numshardbits(4),</a>
<a name="ln262">      WAL_ttl_seconds(0),</a>
<a name="ln263">      WAL_size_limit_MB(0),</a>
<a name="ln264">      manifest_preallocation_size(64 * 1024),</a>
<a name="ln265">      allow_os_buffer(true),</a>
<a name="ln266">      allow_mmap_reads(false),</a>
<a name="ln267">      allow_mmap_writes(false),</a>
<a name="ln268">      allow_fallocate(true),</a>
<a name="ln269">      is_fd_close_on_exec(true),</a>
<a name="ln270">      skip_log_error_on_recovery(false),</a>
<a name="ln271">      stats_dump_period_sec(600),</a>
<a name="ln272">      advise_random_on_open(true),</a>
<a name="ln273">      db_write_buffer_size(0),</a>
<a name="ln274">      access_hint_on_compaction_start(NORMAL),</a>
<a name="ln275">      new_table_reader_for_compaction_inputs(false),</a>
<a name="ln276">      compaction_readahead_size(0),</a>
<a name="ln277">      random_access_max_buffer_size(1024 * 1024),</a>
<a name="ln278">      writable_file_max_buffer_size(1024 * 1024),</a>
<a name="ln279">      use_adaptive_mutex(false),</a>
<a name="ln280">      bytes_per_sync(0),</a>
<a name="ln281">      wal_bytes_per_sync(0),</a>
<a name="ln282">      listeners(),</a>
<a name="ln283">      enable_thread_tracking(false),</a>
<a name="ln284">      delayed_write_rate(2 * 1024U * 1024U),</a>
<a name="ln285">      allow_concurrent_memtable_write(false),</a>
<a name="ln286">      enable_write_thread_adaptive_yield(false),</a>
<a name="ln287">      write_thread_max_yield_usec(100),</a>
<a name="ln288">      write_thread_slow_yield_usec(3),</a>
<a name="ln289">      skip_stats_update_on_db_open(false),</a>
<a name="ln290">      wal_recovery_mode(WALRecoveryMode::kTolerateCorruptedTailRecords),</a>
<a name="ln291">      row_cache(nullptr),</a>
<a name="ln292">#ifndef ROCKSDB_LITE</a>
<a name="ln293">      wal_filter(nullptr),</a>
<a name="ln294">#endif  // ROCKSDB_LITE</a>
<a name="ln295">      fail_if_options_file_error(false) {</a>
<a name="ln296">}</a>
<a name="ln297"> </a>
<a name="ln298">static const char* const access_hints[] = {</a>
<a name="ln299">  &quot;NONE&quot;, &quot;NORMAL&quot;, &quot;SEQUENTIAL&quot;, &quot;WILLNEED&quot;</a>
<a name="ln300">};</a>
<a name="ln301"> </a>
<a name="ln302">void DBOptions::Dump(Logger* log) const {</a>
<a name="ln303">  RHEADER(log, &quot;         Options.error_if_exists: %d&quot;, error_if_exists);</a>
<a name="ln304">  RHEADER(log, &quot;       Options.create_if_missing: %d&quot;, create_if_missing);</a>
<a name="ln305">  RHEADER(log, &quot;         Options.paranoid_checks: %d&quot;, paranoid_checks);</a>
<a name="ln306">  RHEADER(log, &quot;                     Options.env: %p&quot;, env);</a>
<a name="ln307">  RHEADER(log, &quot;                Options.info_log: %p&quot;, info_log.get());</a>
<a name="ln308">  RHEADER(log, &quot;          Options.max_open_files: %d&quot;, max_open_files);</a>
<a name="ln309">  RHEADER(log,</a>
<a name="ln310">      &quot;Options.max_file_opening_threads: %d&quot;, max_file_opening_threads);</a>
<a name="ln311">  RHEADER(log,</a>
<a name="ln312">      &quot;      Options.max_total_wal_size: %&quot; PRIu64, max_total_wal_size);</a>
<a name="ln313">  RHEADER(log, &quot;       Options.disableDataSync: %d&quot;, disableDataSync);</a>
<a name="ln314">  RHEADER(log, &quot;             Options.use_fsync: %d&quot;, use_fsync);</a>
<a name="ln315">  RHEADER(log, &quot;     Options.max_log_file_size: %&quot; ROCKSDB_PRIszt,</a>
<a name="ln316">         max_log_file_size);</a>
<a name="ln317">  RHEADER(log, &quot;Options.max_manifest_file_size: %&quot; PRIu64,</a>
<a name="ln318">      max_manifest_file_size);</a>
<a name="ln319">  RHEADER(log, &quot;     Options.log_file_time_to_roll: %&quot; ROCKSDB_PRIszt,</a>
<a name="ln320">         log_file_time_to_roll);</a>
<a name="ln321">  RHEADER(log, &quot;     Options.keep_log_file_num: %&quot; ROCKSDB_PRIszt,</a>
<a name="ln322">         keep_log_file_num);</a>
<a name="ln323">  RHEADER(log, &quot;  Options.recycle_log_file_num: %&quot; ROCKSDB_PRIszt,</a>
<a name="ln324">           recycle_log_file_num);</a>
<a name="ln325">  RHEADER(log, &quot;       Options.allow_os_buffer: %d&quot;, allow_os_buffer);</a>
<a name="ln326">  RHEADER(log, &quot;      Options.allow_mmap_reads: %d&quot;, allow_mmap_reads);</a>
<a name="ln327">  RHEADER(log, &quot;      Options.allow_fallocate: %d&quot;, allow_fallocate);</a>
<a name="ln328">  RHEADER(log, &quot;     Options.allow_mmap_writes: %d&quot;, allow_mmap_writes);</a>
<a name="ln329">  RHEADER(log, &quot;         Options.create_missing_column_families: %d&quot;,</a>
<a name="ln330">      create_missing_column_families);</a>
<a name="ln331">  RHEADER(log, &quot;                             Options.db_log_dir: %s&quot;,</a>
<a name="ln332">      db_log_dir.c_str());</a>
<a name="ln333">  RHEADER(log, &quot;                                Options.wal_dir: %s&quot;,</a>
<a name="ln334">      wal_dir.c_str());</a>
<a name="ln335">  RHEADER(log, &quot;               Options.table_cache_numshardbits: %d&quot;,</a>
<a name="ln336">      table_cache_numshardbits);</a>
<a name="ln337">  RHEADER(log, &quot;    Options.delete_obsolete_files_period_micros: %&quot; PRIu64,</a>
<a name="ln338">      delete_obsolete_files_period_micros);</a>
<a name="ln339">  RHEADER(log, &quot;             Options.base_background_compactions: %d&quot;,</a>
<a name="ln340">      base_background_compactions);</a>
<a name="ln341">  RHEADER(log, &quot;             Options.max_background_compactions: %d&quot;,</a>
<a name="ln342">      max_background_compactions);</a>
<a name="ln343">  RHEADER(log, &quot;                     Options.max_subcompactions: %&quot; PRIu32,</a>
<a name="ln344">      max_subcompactions);</a>
<a name="ln345">  RHEADER(log, &quot;                 Options.max_background_flushes: %d&quot;,</a>
<a name="ln346">      max_background_flushes);</a>
<a name="ln347">  RHEADER(log, &quot;                        Options.WAL_ttl_seconds: %&quot; PRIu64,</a>
<a name="ln348">      WAL_ttl_seconds);</a>
<a name="ln349">  RHEADER(log, &quot;                      Options.WAL_size_limit_MB: %&quot; PRIu64,</a>
<a name="ln350">      WAL_size_limit_MB);</a>
<a name="ln351">  RHEADER(log,</a>
<a name="ln352">      &quot;            Options.manifest_preallocation_size: %&quot; ROCKSDB_PRIszt,</a>
<a name="ln353">         manifest_preallocation_size);</a>
<a name="ln354">  RHEADER(log, &quot;                         Options.allow_os_buffer: %d&quot;,</a>
<a name="ln355">      allow_os_buffer);</a>
<a name="ln356">  RHEADER(log, &quot;                        Options.allow_mmap_reads: %d&quot;,</a>
<a name="ln357">      allow_mmap_reads);</a>
<a name="ln358">  RHEADER(log, &quot;                       Options.allow_mmap_writes: %d&quot;,</a>
<a name="ln359">      allow_mmap_writes);</a>
<a name="ln360">  RHEADER(log, &quot;                     Options.is_fd_close_on_exec: %d&quot;,</a>
<a name="ln361">      is_fd_close_on_exec);</a>
<a name="ln362">  RHEADER(log, &quot;                   Options.stats_dump_period_sec: %u&quot;,</a>
<a name="ln363">      stats_dump_period_sec);</a>
<a name="ln364">  RHEADER(log, &quot;                   Options.advise_random_on_open: %d&quot;,</a>
<a name="ln365">      advise_random_on_open);</a>
<a name="ln366">  RHEADER(log,</a>
<a name="ln367">      &quot;                    Options.db_write_buffer_size: %&quot; ROCKSDB_PRIszt</a>
<a name="ln368">         &quot;d&quot;,</a>
<a name="ln369">         db_write_buffer_size);</a>
<a name="ln370">  RHEADER(log, &quot;         Options.access_hint_on_compaction_start: %s&quot;,</a>
<a name="ln371">      access_hints[access_hint_on_compaction_start]);</a>
<a name="ln372">  RHEADER(log, &quot;  Options.new_table_reader_for_compaction_inputs: %d&quot;,</a>
<a name="ln373">      new_table_reader_for_compaction_inputs);</a>
<a name="ln374">  RHEADER(log,</a>
<a name="ln375">      &quot;               Options.compaction_readahead_size: %&quot; ROCKSDB_PRIszt</a>
<a name="ln376">         &quot;d&quot;,</a>
<a name="ln377">         compaction_readahead_size);</a>
<a name="ln378">  RHEADER(</a>
<a name="ln379">      log,</a>
<a name="ln380">      &quot;               Options.random_access_max_buffer_size: %&quot; ROCKSDB_PRIszt</a>
<a name="ln381">        &quot;d&quot;,</a>
<a name="ln382">        random_access_max_buffer_size);</a>
<a name="ln383">  RHEADER(log,</a>
<a name="ln384">      &quot;              Options.writable_file_max_buffer_size: %&quot; ROCKSDB_PRIszt</a>
<a name="ln385">         &quot;d&quot;,</a>
<a name="ln386">         writable_file_max_buffer_size);</a>
<a name="ln387">  RHEADER(log, &quot;                      Options.use_adaptive_mutex: %d&quot;,</a>
<a name="ln388">      use_adaptive_mutex);</a>
<a name="ln389">  RHEADER(log, &quot;                            Options.rate_limiter: %p&quot;,</a>
<a name="ln390">      rate_limiter.get());</a>
<a name="ln391">  RHEADER(</a>
<a name="ln392">      log, &quot;     Options.sst_file_manager.rate_bytes_per_sec: %&quot; PRIi64,</a>
<a name="ln393">      sst_file_manager ? sst_file_manager-&gt;GetDeleteRateBytesPerSecond() : 0);</a>
<a name="ln394">  RHEADER(log, &quot;                          Options.bytes_per_sync: %&quot; PRIu64,</a>
<a name="ln395">      bytes_per_sync);</a>
<a name="ln396">  RHEADER(log, &quot;                      Options.wal_bytes_per_sync: %&quot; PRIu64,</a>
<a name="ln397">      wal_bytes_per_sync);</a>
<a name="ln398">  RHEADER(log, &quot;                       Options.wal_recovery_mode: %d&quot;,</a>
<a name="ln399">      wal_recovery_mode);</a>
<a name="ln400">  RHEADER(log, &quot;                  Options.enable_thread_tracking: %d&quot;,</a>
<a name="ln401">      enable_thread_tracking);</a>
<a name="ln402">  RHEADER(log, &quot;         Options.allow_concurrent_memtable_write: %d&quot;,</a>
<a name="ln403">      allow_concurrent_memtable_write);</a>
<a name="ln404">  RHEADER(log, &quot;      Options.enable_write_thread_adaptive_yield: %d&quot;,</a>
<a name="ln405">      enable_write_thread_adaptive_yield);</a>
<a name="ln406">  RHEADER(log, &quot;             Options.write_thread_max_yield_usec: %&quot; PRIu64,</a>
<a name="ln407">      write_thread_max_yield_usec);</a>
<a name="ln408">  RHEADER(log, &quot;            Options.write_thread_slow_yield_usec: %&quot; PRIu64,</a>
<a name="ln409">      write_thread_slow_yield_usec);</a>
<a name="ln410">    if (row_cache) {</a>
<a name="ln411">      RHEADER(log, &quot;                               Options.row_cache: %&quot; PRIu64,</a>
<a name="ln412">          row_cache-&gt;GetCapacity());</a>
<a name="ln413">    } else {</a>
<a name="ln414">      RHEADER(log, &quot;                               Options.row_cache: None&quot;);</a>
<a name="ln415">    }</a>
<a name="ln416">  RHEADER(log, &quot;                           Options.initial_seqno: %&quot; PRIu64, initial_seqno);</a>
<a name="ln417">#ifndef ROCKSDB_LITE</a>
<a name="ln418">  RHEADER(log, &quot;       Options.wal_filter: %s&quot;,</a>
<a name="ln419">      wal_filter ? wal_filter-&gt;Name() : &quot;None&quot;);</a>
<a name="ln420">#endif  // ROCKDB_LITE</a>
<a name="ln421">}  // DBOptions::Dump</a>
<a name="ln422"> </a>
<a name="ln423">void ColumnFamilyOptions::Dump(Logger* log) const {</a>
<a name="ln424">  RHEADER(log, &quot;              Options.comparator: %s&quot;, comparator-&gt;Name());</a>
<a name="ln425">  RHEADER(log, &quot;          Options.merge_operator: %s&quot;,</a>
<a name="ln426">      merge_operator ? merge_operator-&gt;Name() : &quot;None&quot;);</a>
<a name="ln427">  RHEADER(log, &quot;       Options.compaction_filter: %s&quot;,</a>
<a name="ln428">      compaction_filter ? compaction_filter-&gt;Name() : &quot;None&quot;);</a>
<a name="ln429">  RHEADER(log, &quot;       Options.compaction_filter_factory: %s&quot;,</a>
<a name="ln430">      compaction_filter_factory ? compaction_filter_factory-&gt;Name() : &quot;None&quot;);</a>
<a name="ln431">  RHEADER(log, &quot;        Options.memtable_factory: %s&quot;, memtable_factory-&gt;Name());</a>
<a name="ln432">  RHEADER(log, &quot;           Options.table_factory: %s&quot;, table_factory-&gt;Name());</a>
<a name="ln433">  RHEADER(log, &quot;           table_factory options: %s&quot;,</a>
<a name="ln434">      table_factory-&gt;GetPrintableTableOptions().c_str());</a>
<a name="ln435">  RHEADER(log, &quot;       Options.write_buffer_size: %&quot; ROCKSDB_PRIszt,</a>
<a name="ln436">       write_buffer_size);</a>
<a name="ln437">  RHEADER(log, &quot; Options.max_write_buffer_number: %d&quot;, max_write_buffer_number);</a>
<a name="ln438">    if (!compression_per_level.empty()) {</a>
<a name="ln439">      for (unsigned int i = 0; i &lt; compression_per_level.size(); i++) {</a>
<a name="ln440">        RHEADER(log, &quot;       Options.compression[%d]: %s&quot;, i,</a>
<a name="ln441">            CompressionTypeToString(compression_per_level[i]).c_str());</a>
<a name="ln442">      }</a>
<a name="ln443">    } else {</a>
<a name="ln444">      RHEADER(log, &quot;         Options.compression: %s&quot;,</a>
<a name="ln445">          CompressionTypeToString(compression).c_str());</a>
<a name="ln446">    }</a>
<a name="ln447">  RHEADER(log, &quot;      Options.prefix_extractor: %s&quot;,</a>
<a name="ln448">      prefix_extractor == nullptr ? &quot;nullptr&quot; : prefix_extractor-&gt;Name());</a>
<a name="ln449">  RHEADER(log, &quot;            Options.num_levels: %d&quot;, num_levels);</a>
<a name="ln450">  RHEADER(log, &quot;       Options.min_write_buffer_number_to_merge: %d&quot;,</a>
<a name="ln451">      min_write_buffer_number_to_merge);</a>
<a name="ln452">  RHEADER(log, &quot;    Options.max_write_buffer_number_to_maintain: %d&quot;,</a>
<a name="ln453">      max_write_buffer_number_to_maintain);</a>
<a name="ln454">  RHEADER(log, &quot;           Options.compression_opts.window_bits: %d&quot;,</a>
<a name="ln455">      compression_opts.window_bits);</a>
<a name="ln456">  RHEADER(log, &quot;                 Options.compression_opts.level: %d&quot;,</a>
<a name="ln457">      compression_opts.level);</a>
<a name="ln458">  RHEADER(log, &quot;              Options.compression_opts.strategy: %d&quot;,</a>
<a name="ln459">      compression_opts.strategy);</a>
<a name="ln460">  RHEADER(log, &quot;     Options.level0_file_num_compaction_trigger: %d&quot;,</a>
<a name="ln461">      level0_file_num_compaction_trigger);</a>
<a name="ln462">  RHEADER(log, &quot;         Options.level0_slowdown_writes_trigger: %d&quot;,</a>
<a name="ln463">      level0_slowdown_writes_trigger);</a>
<a name="ln464">  RHEADER(log, &quot;             Options.level0_stop_writes_trigger: %d&quot;,</a>
<a name="ln465">      level0_stop_writes_trigger);</a>
<a name="ln466">  RHEADER(log, &quot;                  Options.target_file_size_base: %&quot; PRIu64,</a>
<a name="ln467">      target_file_size_base);</a>
<a name="ln468">  RHEADER(log, &quot;            Options.target_file_size_multiplier: %d&quot;,</a>
<a name="ln469">      target_file_size_multiplier);</a>
<a name="ln470">  RHEADER(log, &quot;               Options.max_bytes_for_level_base: %&quot; PRIu64,</a>
<a name="ln471">      max_bytes_for_level_base);</a>
<a name="ln472">  RHEADER(log, &quot;Options.level_compaction_dynamic_level_bytes: %d&quot;,</a>
<a name="ln473">      level_compaction_dynamic_level_bytes);</a>
<a name="ln474">  RHEADER(log, &quot;         Options.max_bytes_for_level_multiplier: %d&quot;,</a>
<a name="ln475">      max_bytes_for_level_multiplier);</a>
<a name="ln476">    for (size_t i = 0; i &lt; max_bytes_for_level_multiplier_additional.size();</a>
<a name="ln477">         i++) {</a>
<a name="ln478">      RHEADER(log,</a>
<a name="ln479">          &quot;Options.max_bytes_for_level_multiplier_addtl[%&quot; ROCKSDB_PRIszt</a>
<a name="ln480">                &quot;]: %d&quot;,</a>
<a name="ln481">           i, max_bytes_for_level_multiplier_additional[i]);</a>
<a name="ln482">    }</a>
<a name="ln483">  RHEADER(log, &quot;      Options.max_sequential_skip_in_iterations: %&quot; PRIu64,</a>
<a name="ln484">      max_sequential_skip_in_iterations);</a>
<a name="ln485">  RHEADER(log, &quot;             Options.expanded_compaction_factor: %d&quot;,</a>
<a name="ln486">      expanded_compaction_factor);</a>
<a name="ln487">  RHEADER(log, &quot;               Options.source_compaction_factor: %d&quot;,</a>
<a name="ln488">      source_compaction_factor);</a>
<a name="ln489">  RHEADER(log, &quot;         Options.max_grandparent_overlap_factor: %d&quot;,</a>
<a name="ln490">      max_grandparent_overlap_factor);</a>
<a name="ln491"> </a>
<a name="ln492">  RHEADER(log,</a>
<a name="ln493">      &quot;                       Options.arena_block_size: %&quot; ROCKSDB_PRIszt,</a>
<a name="ln494">         arena_block_size);</a>
<a name="ln495">  RHEADER(log, &quot;  Options.soft_pending_compaction_bytes_limit: %&quot; PRIu64,</a>
<a name="ln496">      soft_pending_compaction_bytes_limit);</a>
<a name="ln497">  RHEADER(log, &quot;  Options.hard_pending_compaction_bytes_limit: %&quot; PRIu64,</a>
<a name="ln498">      hard_pending_compaction_bytes_limit);</a>
<a name="ln499">  RHEADER(log, &quot;      Options.rate_limit_delay_max_milliseconds: %u&quot;,</a>
<a name="ln500">      rate_limit_delay_max_milliseconds);</a>
<a name="ln501">  RHEADER(log, &quot;               Options.disable_auto_compactions: %d&quot;,</a>
<a name="ln502">      disable_auto_compactions);</a>
<a name="ln503">  RHEADER(log, &quot;                          Options.filter_deletes: %d&quot;,</a>
<a name="ln504">      filter_deletes);</a>
<a name="ln505">  RHEADER(log, &quot;          Options.verify_checksums_in_compaction: %d&quot;,</a>
<a name="ln506">      verify_checksums_in_compaction);</a>
<a name="ln507">  RHEADER(log, &quot;                        Options.compaction_style: %d&quot;,</a>
<a name="ln508">      compaction_style);</a>
<a name="ln509">  RHEADER(log, &quot;                          Options.compaction_pri: %d&quot;,</a>
<a name="ln510">      compaction_pri);</a>
<a name="ln511">  RHEADER(log, &quot; Options.compaction_options_universal.size_ratio: %u&quot;,</a>
<a name="ln512">      compaction_options_universal.size_ratio);</a>
<a name="ln513">  RHEADER(log, &quot;Options.compaction_options_universal.&quot;</a>
<a name="ln514">          &quot;always_include_size_threshold: %&quot; ROCKSDB_PRIszt,</a>
<a name="ln515">          compaction_options_universal.always_include_size_threshold);</a>
<a name="ln516">  RHEADER(log, &quot;Options.compaction_options_universal.min_merge_width: %u&quot;,</a>
<a name="ln517">      compaction_options_universal.min_merge_width);</a>
<a name="ln518">  RHEADER(log, &quot;Options.compaction_options_universal.max_merge_width: %u&quot;,</a>
<a name="ln519">      compaction_options_universal.max_merge_width);</a>
<a name="ln520">  RHEADER(log, &quot;Options.compaction_options_universal.&quot;</a>
<a name="ln521">          &quot;max_size_amplification_percent: %u&quot;,</a>
<a name="ln522">      compaction_options_universal.max_size_amplification_percent);</a>
<a name="ln523">  RHEADER(log,</a>
<a name="ln524">      &quot;Options.compaction_options_universal.compression_size_percent: %d&quot;,</a>
<a name="ln525">      compaction_options_universal.compression_size_percent);</a>
<a name="ln526">  RHEADER(log,</a>
<a name="ln527">      &quot;Options.compaction_options_fifo.max_table_files_size: %&quot; PRIu64,</a>
<a name="ln528">      compaction_options_fifo.max_table_files_size);</a>
<a name="ln529">    std::string collector_names;</a>
<a name="ln530">    for (const auto&amp; collector_factory : table_properties_collector_factories) {</a>
<a name="ln531">      collector_names.append(collector_factory-&gt;Name());</a>
<a name="ln532">      collector_names.append(&quot;; &quot;);</a>
<a name="ln533">    }</a>
<a name="ln534">  RHEADER(log, &quot;                  Options.table_properties_collectors: %s&quot;,</a>
<a name="ln535">      collector_names.c_str());</a>
<a name="ln536">  RHEADER(log, &quot;                  Options.inplace_update_support: %d&quot;,</a>
<a name="ln537">      inplace_update_support);</a>
<a name="ln538">  RHEADER(log,</a>
<a name="ln539">      &quot;                Options.inplace_update_num_locks: %&quot; ROCKSDB_PRIszt,</a>
<a name="ln540">         inplace_update_num_locks);</a>
<a name="ln541">  RHEADER(log, &quot;              Options.min_partial_merge_operands: %u&quot;,</a>
<a name="ln542">      min_partial_merge_operands);</a>
<a name="ln543">    // TODO: easier config for bloom (maybe based on avg key/value size)</a>
<a name="ln544">  RHEADER(log, &quot;              Options.memtable_prefix_bloom_bits: %d&quot;,</a>
<a name="ln545">      memtable_prefix_bloom_bits);</a>
<a name="ln546">  RHEADER(log, &quot;            Options.memtable_prefix_bloom_probes: %d&quot;,</a>
<a name="ln547">      memtable_prefix_bloom_probes);</a>
<a name="ln548"> </a>
<a name="ln549">  RHEADER(log,</a>
<a name="ln550">      &quot;  Options.memtable_prefix_bloom_huge_page_tlb_size: %&quot; ROCKSDB_PRIszt,</a>
<a name="ln551">         memtable_prefix_bloom_huge_page_tlb_size);</a>
<a name="ln552">  RHEADER(log, &quot;                          Options.bloom_locality: %d&quot;,</a>
<a name="ln553">      bloom_locality);</a>
<a name="ln554"> </a>
<a name="ln555">  RHEADER(log,</a>
<a name="ln556">      &quot;                   Options.max_successive_merges: %&quot; ROCKSDB_PRIszt,</a>
<a name="ln557">         max_successive_merges);</a>
<a name="ln558">  RHEADER(log, &quot;               Options.optimize_filters_for_hits: %d&quot;,</a>
<a name="ln559">      optimize_filters_for_hits);</a>
<a name="ln560">  RHEADER(log, &quot;               Options.paranoid_file_checks: %d&quot;,</a>
<a name="ln561">      paranoid_file_checks);</a>
<a name="ln562">  RHEADER(log, &quot;               Options.compaction_measure_io_stats: %d&quot;,</a>
<a name="ln563">      compaction_measure_io_stats);</a>
<a name="ln564">}  // ColumnFamilyOptions::Dump</a>
<a name="ln565"> </a>
<a name="ln566">void Options::Dump(Logger* log) const {</a>
<a name="ln567">  DBOptions::Dump(log);</a>
<a name="ln568">  ColumnFamilyOptions::Dump(log);</a>
<a name="ln569">}   // Options::Dump</a>
<a name="ln570"> </a>
<a name="ln571">void Options::DumpCFOptions(Logger* log) const {</a>
<a name="ln572">  ColumnFamilyOptions::Dump(log);</a>
<a name="ln573">}  // Options::DumpCFOptions</a>
<a name="ln574"> </a>
<a name="ln575">//</a>
<a name="ln576">// The goal of this method is to create a configuration that</a>
<a name="ln577">// allows an application to write all files into L0 and</a>
<a name="ln578">// then do a single compaction to output all files into L1.</a>
<a name="ln579">Options*</a>
<a name="ln580">Options::PrepareForBulkLoad() {</a>
<a name="ln581">  // never slowdown ingest.</a>
<a name="ln582">  level0_file_num_compaction_trigger = (1&lt;&lt;30);</a>
<a name="ln583">  level0_slowdown_writes_trigger = (1&lt;&lt;30);</a>
<a name="ln584">  level0_stop_writes_trigger = (1&lt;&lt;30);</a>
<a name="ln585"> </a>
<a name="ln586">  // no auto compactions please. The application should issue a</a>
<a name="ln587">  // manual compaction after all data is loaded into L0.</a>
<a name="ln588">  disable_auto_compactions = true;</a>
<a name="ln589">  disableDataSync = true;</a>
<a name="ln590"> </a>
<a name="ln591">  // A manual compaction run should pick all files in L0 in</a>
<a name="ln592">  // a single compaction run.</a>
<a name="ln593">  source_compaction_factor = (1&lt;&lt;30);</a>
<a name="ln594"> </a>
<a name="ln595">  // It is better to have only 2 levels, otherwise a manual</a>
<a name="ln596">  // compaction would compact at every possible level, thereby</a>
<a name="ln597">  // increasing the total time needed for compactions.</a>
<a name="ln598">  num_levels = 2;</a>
<a name="ln599"> </a>
<a name="ln600">  // Need to allow more write buffers to allow more parallism</a>
<a name="ln601">  // of flushes.</a>
<a name="ln602">  max_write_buffer_number = 6;</a>
<a name="ln603">  min_write_buffer_number_to_merge = 1;</a>
<a name="ln604"> </a>
<a name="ln605">  // When compaction is disabled, more parallel flush threads can</a>
<a name="ln606">  // help with write throughput.</a>
<a name="ln607">  max_background_flushes = 4;</a>
<a name="ln608"> </a>
<a name="ln609">  // Prevent a memtable flush to automatically promote files</a>
<a name="ln610">  // to L1. This is helpful so that all files that are</a>
<a name="ln611">  // input to the manual compaction are all at L0.</a>
<a name="ln612">  max_background_compactions = 2;</a>
<a name="ln613">  base_background_compactions = 2;</a>
<a name="ln614"> </a>
<a name="ln615">  // The compaction would create large files in L1.</a>
<a name="ln616">  target_file_size_base = 256 * 1024 * 1024;</a>
<a name="ln617">  return this;</a>
<a name="ln618">}</a>
<a name="ln619"> </a>
<a name="ln620">#ifndef ROCKSDB_LITE</a>
<a name="ln621">// Optimization functions</a>
<a name="ln622">ColumnFamilyOptions* ColumnFamilyOptions::OptimizeForPointLookup(</a>
<a name="ln623">    uint64_t block_cache_size_mb) {</a>
<a name="ln624">  prefix_extractor.reset(NewNoopTransform());</a>
<a name="ln625">  BlockBasedTableOptions block_based_options;</a>
<a name="ln626">  block_based_options.index_type = IndexType::kHashSearch;</a>
<a name="ln627">  block_based_options.filter_policy.reset(NewBloomFilterPolicy(10));</a>
<a name="ln628">  block_based_options.block_cache =</a>
<a name="ln629">      NewLRUCache(static_cast&lt;size_t&gt;(block_cache_size_mb * 1024 * 1024));</a>
<a name="ln630">  table_factory.reset(new BlockBasedTableFactory(block_based_options));</a>
<a name="ln631">  memtable_factory.reset(NewHashLinkListRepFactory());</a>
<a name="ln632">  return this;</a>
<a name="ln633">}</a>
<a name="ln634"> </a>
<a name="ln635">ColumnFamilyOptions* ColumnFamilyOptions::OptimizeLevelStyleCompaction(</a>
<a name="ln636">    uint64_t memtable_memory_budget) {</a>
<a name="ln637">  write_buffer_size = static_cast&lt;size_t&gt;(memtable_memory_budget / 4);</a>
<a name="ln638">  // merge two memtables when flushing to L0</a>
<a name="ln639">  min_write_buffer_number_to_merge = 2;</a>
<a name="ln640">  // this means we'll use 50% extra memory in the worst case, but will reduce</a>
<a name="ln641">  // write stalls.</a>
<a name="ln642">  max_write_buffer_number = 6;</a>
<a name="ln643">  // start flushing L0-&gt;L1 as soon as possible. each file on level0 is</a>
<a name="ln644">  // (memtable_memory_budget / 2). This will flush level 0 when it's bigger than</a>
<a name="ln645">  // memtable_memory_budget.</a>
<a name="ln646">  level0_file_num_compaction_trigger = 2;</a>
<a name="ln647">  // doesn't really matter much, but we don't want to create too many files</a>
<a name="ln648">  target_file_size_base = memtable_memory_budget / 8;</a>
<a name="ln649">  // make Level1 size equal to Level0 size, so that L0-&gt;L1 compactions are fast</a>
<a name="ln650">  max_bytes_for_level_base = memtable_memory_budget;</a>
<a name="ln651"> </a>
<a name="ln652">  // level style compaction</a>
<a name="ln653">  compaction_style = kCompactionStyleLevel;</a>
<a name="ln654"> </a>
<a name="ln655">  // only compress levels &gt;= 2</a>
<a name="ln656">  compression_per_level.resize(num_levels);</a>
<a name="ln657">  for (int i = 0; i &lt; num_levels; ++i) {</a>
<a name="ln658">    if (i &lt; 2) {</a>
<a name="ln659">      compression_per_level[i] = kNoCompression;</a>
<a name="ln660">    } else {</a>
<a name="ln661">      compression_per_level[i] = kSnappyCompression;</a>
<a name="ln662">    }</a>
<a name="ln663">  }</a>
<a name="ln664">  return this;</a>
<a name="ln665">}</a>
<a name="ln666"> </a>
<a name="ln667">ColumnFamilyOptions* ColumnFamilyOptions::OptimizeUniversalStyleCompaction(</a>
<a name="ln668">    uint64_t memtable_memory_budget) {</a>
<a name="ln669">  write_buffer_size = static_cast&lt;size_t&gt;(memtable_memory_budget / 4);</a>
<a name="ln670">  // merge two memtables when flushing to L0</a>
<a name="ln671">  min_write_buffer_number_to_merge = 2;</a>
<a name="ln672">  // this means we'll use 50% extra memory in the worst case, but will reduce</a>
<a name="ln673">  // write stalls.</a>
<a name="ln674">  max_write_buffer_number = 6;</a>
<a name="ln675">  // universal style compaction</a>
<a name="ln676">  compaction_style = kCompactionStyleUniversal;</a>
<a name="ln677">  compaction_options_universal.compression_size_percent = 80;</a>
<a name="ln678">  return this;</a>
<a name="ln679">}</a>
<a name="ln680"> </a>
<a name="ln681">DBOptions* DBOptions::IncreaseParallelism(int total_threads) {</a>
<a name="ln682">  max_background_compactions = total_threads - 1;</a>
<a name="ln683">  max_background_flushes = 1;</a>
<a name="ln684">  env-&gt;SetBackgroundThreads(total_threads, Env::LOW);</a>
<a name="ln685">  env-&gt;SetBackgroundThreads(1, Env::HIGH);</a>
<a name="ln686">  return this;</a>
<a name="ln687">}</a>
<a name="ln688"> </a>
<a name="ln689">#endif  // !ROCKSDB_LITE</a>
<a name="ln690"> </a>
<a name="ln691">const ReadOptions ReadOptions::kDefault;</a>
<a name="ln692"> </a>
<a name="ln693">ReadOptions::ReadOptions()</a>
<a name="ln694">    : verify_checksums(true),</a>
<a name="ln695">      fill_cache(true),</a>
<a name="ln696">      snapshot(nullptr),</a>
<a name="ln697">      iterate_upper_bound(nullptr),</a>
<a name="ln698">      read_tier(kReadAllTier),</a>
<a name="ln699">      tailing(false),</a>
<a name="ln700">      managed(false),</a>
<a name="ln701">      total_order_seek(false),</a>
<a name="ln702">      prefix_same_as_start(false),</a>
<a name="ln703">      pin_data(false),</a>
<a name="ln704">      query_id(rocksdb::kDefaultQueryId) {</a>
<a name="ln705">  XFUNC_TEST(&quot;&quot;, &quot;managed_options&quot;, managed_options, xf_manage_options,</a>
<a name="ln706">             reinterpret_cast&lt;ReadOptions*&gt;(this));</a>
<a name="ln707">}</a>
<a name="ln708"> </a>
<a name="ln709">ReadOptions::ReadOptions(bool cksum, bool cache)</a>
<a name="ln710">    : verify_checksums(cksum),</a>
<a name="ln711">      fill_cache(cache),</a>
<a name="ln712">      snapshot(nullptr),</a>
<a name="ln713">      iterate_upper_bound(nullptr),</a>
<a name="ln714">      read_tier(kReadAllTier),</a>
<a name="ln715">      tailing(false),</a>
<a name="ln716">      managed(false),</a>
<a name="ln717">      total_order_seek(false),</a>
<a name="ln718">      prefix_same_as_start(false),</a>
<a name="ln719">      pin_data(false),</a>
<a name="ln720">      query_id(rocksdb::kDefaultQueryId) {</a>
<a name="ln721">  XFUNC_TEST(&quot;&quot;, &quot;managed_options&quot;, managed_options, xf_manage_options,</a>
<a name="ln722">             reinterpret_cast&lt;ReadOptions*&gt;(this));</a>
<a name="ln723">}</a>
<a name="ln724"> </a>
<a name="ln725">std::atomic&lt;int64_t&gt; flush_tick_(1);</a>
<a name="ln726"> </a>
<a name="ln727">int64_t FlushTick() {</a>
<a name="ln728">  return flush_tick_.fetch_add(1, std::memory_order_acq_rel);</a>
<a name="ln729">}</a>
<a name="ln730"> </a>
<a name="ln731">}  // namespace rocksdb</a>

</code></pre>
<div class="balloon" rel="98"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v730/" target="_blank">V730</a> Not all members of a class are initialized inside the constructor. Consider inspecting: max_mem_compaction_level.</p></div>
<div class="balloon" rel="153"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v730/" target="_blank">V730</a> Not all members of a class are initialized inside the constructor. Consider inspecting: max_mem_compaction_level, hard_rate_limit.</p></div>
<div class="balloon" rel="53"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v730/" target="_blank">V730</a> Not all members of a class are initialized inside the constructor. Consider inspecting: info_log_level.</p></div>

<link rel="stylesheet" href="highlight.css">
<script src="highlight.pack.js"></script>
<script src="highlightjs-line-numbers.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>hljs.initLineNumbersOnLoad();</script>
<script>
  $(document).ready(function() {
      $('.balloon').each(function () {
          var bl = $(this);
          var line = bl.attr('rel');
          var text = $('a[name="ln'+line+'"]').text();

          var space_count = 0;
          for(var i = 0; i<text.length; i++){
              var char = text[i];
              if((char !== ' ')&&(char !== '\t'))break;
              if(char === '\t')space_count++;
              space_count++;
          }

          bl.css('margin-left', space_count*8);
          $('a[name="ln'+line+'"]').after(bl);
      });

      window.location = window.location;
  });
</script>
</body>
</html>
